<div class="content">
  <h1>Modder search</h1>
</div>

<div class="content grid search-fields">

  <%= form_with url: modders_path, method: 'get', html: { class: "form span-#{ @results_visible ? '4 sidebar' : '8' }" } do |form| %>

    <div class="field">
      <label class="label">Services offered</label>
      <%=
        react_component "ServiceSelector", {
          field_name: 'services',
          all_services: ModderService.enabled_services.map { |slug, service| { value: slug, label: service[:name], color: service[:color] } },
          selected_services: @services.map { |slug|
            service = ModderService::ALL_SERVICES[slug.to_sym]
            next if service.blank?
            {
              value: slug,
              label: service[:name],
              color: service[:color]
            }
          }
        }
      %>
    </div>

    <div class="field">
      <label class="label">Location</label>
      <%=
        react_component "LocationSelector", {
          class: "search #{ @results_visible ? 'full-width' : 'large' }",
          geolocator: true,
          city: @city || "",
          latitude: @latitude || "",
          longitude: @longitude || ""
        }
      %>
    </div>

    <div class="field">
      <%= form.label :query, 'Modder name', class: 'label' %>
      <%= form.text_field :query, value: @query || '', class: 'text-input xlarge search', placeholder: 'Optional' %>
    </div>

    <div class="actions">
      <%= form.submit @results_visible ? 'Update search' : 'Search', name: nil, class: 'button' %>
    </div>

  <% end %>

  <% if @results_visible %>
    <section class="results span-7">
      <% if @results.any? %>
        <h2><%= @results.length %> <%= 'result'.pluralize(@results.length) %></h2>
      <% end %>
      <% @results.each do |modder| %>

        <section class="modder-info">
          <div class="meta">
            <%= link_to modder do %>
              <figure class="logo" style="<%= "background-image: url(#{modder.logo_url})" if modder.logo.present? %>">
                <% if modder.logo.blank? %>
                  <%= inline_svg_tag 'gcc.svg' %>
                <% end %>
              </figure>
            <% end %>
            <div>
              <%= link_to modder do %><h3><%= modder.name %></h3><% end %>
              <p class="city"><%= inline_svg_tag 'pin' %><%= modder.city %></p>
            </div>
          </div>
          <div class="services">
            <ol>
              <% modder.modder_services.map do |service| %>
                <% svc = ModderService::ALL_SERVICES[service.service.to_sym] %>
                <li style="--service-color: <%= svc[:color] %>"><%= svc[:name] %></li>
              <% end %>
            </ol>
          </div>
        </section>

      <% end %>
    </section>
  <% end %>

</div>
